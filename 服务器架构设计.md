#服务器架构设计

---

##目录

* 环境配置: 开发环境配置概述
* 物理服务器: 物理服务器,解决方案
* 云服务器: 云端解决方案
* 总结

---

##环境配置

####docker

容器,提升交付速度,保障开发环境和生产环境的一致性.

国外已经大范围使用,国内使用厂商有: 京东,阿里,腾讯

####php

后端语言

####mysql 

关系型数据库

####mongoDb 

非关系型数据库

####memcached 

缓存

####redis 

关系型缓存,初期队列解决方案

####elastic Search 

搜索服务

##物理服务器

###扩展性

扩展性较差,后期增配较为麻烦.而且无法动态调配.

###程序服务器配置

16颗VCPU，内存：16GB，硬盘：200G系统盘,数据盘2TB(精简模式)

环境: centos 7.0+

价格: 45,000.00

###数据服务器配置

32颗VCPU,内存:32GB及以上m硬盘:200G系统盘,数据盘3TB(精简模式)

环境: centos 7.0+

价格: 102,000.00

###备份服务器配置

16颗VCPU,内存:8GB,硬盘:200G系统盘,数据盘5TB(精简模式)

环境: centos 7.0+

价格: 45,000.00

###开发环境需求

程序服务器 * 7

* rancher server * 1
* rancher agent * 6
	* 平台管理网站(redmine,jenkins,等后期管理平台) * 1
	* 程序服务器 * 2
	* 数据服务器 * 3

###生成环境需求

server 我们已经在开发服务器部署过.

* rancher agent * 10
	* 程序服务器 * 4
		* 前端服务
		* 后端服务
		* 附件服务
		* 应急服务
	* 数据库服务器 * 5
		* mysql
		* memcached
		* mongodb
		* redis
		* rabbitMq
		* 搜索服务
		* 日志服务
	* 备份服务器 * 1

###运维成本

`需要`专业运维人员维护服务器.

`需要`专业DBA人员维护数据库.需要维护`mysql`,`mongo`,`redis`. 开发人员(dev)专注于开发,而需要运维人员(ops)需要专门维护此类服务.

###人员招聘需求

####运维人员 * 2

1. 负责公司互联网产品的服务端运维方案设计、服务器带宽规划、自动化运维和监控体系构建；
2. 熟练掌握公司所有网络设备、安全设备的配置，熟悉路由器、交换机、负载均衡和防火墙等设备的安装、配置及管理，保障整体网络稳定和高效的运行；
3. 负责对线上阿里云服务器进行故障处理、软件安装、服务申请、网络配置等;
4. 根据研发部提供的上线文档进行独立的服务器端环境搭建及程序上线操作；
5. 负责公司内部网络环境搭建以及问题解决;
6. 维护数据库服务的正常运行和应急响应预案;
7. 了解一门编程语言;
8. 了解k8s,rancher或其他任意类似产品
9. 了解devops
10. 了解docker
11. 了解自动化

####DBA * 1

1. 负责数据库日常运维,性能优化和故障处理

2. 承担研发过程中的数据库相关问题的定位和解决

3. 负责拟定数据库相关的开发、测试、运维和日常管理规范，承担规范落地的检查工作

---

##云服务器

###开发服务器配置

* 地域: 阿里云华东机房
* 实例配置: 2核8GB
* 硬盘(500+100+100)
* 带宽: 1MB
* 包年: 1年

需要 *6 = 费用大致约为`4995*6`一年

###生产服务器配置

生产服务器最好等开发服务器部署测试,包括性能一些的使用测试后在考量购买.

**节点服务器**

* 地域: 阿里云华东机房
* 实例配置: 4核16GB
* 硬盘(500+100+100)
* 带宽: 5MB (不是每台服务器都是5MB带宽,根据需求来确定,有的不对外提供服务则不需要高带宽)
* 包年: 1年
* 系统: centos 7

需要 *6 = 费用大致约为`11954*6`一年

**server服务器**

* 地域: 阿里云华东机房
* 实例配置: 2核8GB
* 硬盘(500+100+100)
* 带宽: 1MB
* 包年: 1年
* 费用大致约为`4995*4`一年

####云RDS

mysql 8核 16G 大约 `25850` 一年,考虑初期访问量不大,后期可以根据需要扩容.按需使用.

####云MongoDb

4核 8G 大约 `14580` 一年,考虑初期访问量不大,后期可以根据需要扩容.按需使用.

####云memcached

2*2GB, `1400`每年.

####云redis 

8G,2000连接数,最大吞吐量(24 MByte) `10800` 年.

###运维成本

`无需`专业DBA和运维人员进行维护.按需扩容.可以根据业务发展灵活变动.开发人员在开发的时候无需过多考虑运维的事情.所有运维与备份委托给云做管理.

###云端内网数据中心方案-混合云

根据需求设计,我们需要在内网开通一个数据中心.可以考虑在内网设置一组服务器.至少4台,保障高可用性.建立内网的中心和服务中心.使用vpn和云端的vpc打通内网和云端的接口.这样我们就可以使用vpn在内外之间同步我们所需的数据.

###总结

**成本**

* 物理机: 初期投入过高,每年维护费用不菲(每年仅仅维护费用已经够足够云端服务器的耗费),需要专业的运维,dba来维护.
* 云: 初期投入很少,0成本运维.

**沟通成本**

* 物理机: 传统出现问题需要随时联系机房人员解决.
* 云: 出现为题概率较低(99.95%可用性,数据可靠性不低于99.999%).

**动态扩容**

* 物理机: 后期扩容较为麻烦.无法实现根据访问量来自动调配服务器实例.一次性选购到位,不能动态升级.
* 云: 云端,初期业务较少,我们可以选用一些低配的设置.后期根据需要在进行升级调配.按需花钱.

		例如,当网站访问高峰时,在云端可以实现自动启动一个实例(服务器),使用完成以后在自动释放实例.达到真正的按需调配.这种动态调配方式无法在物理及部署方面实现.我们需要根据日志监控,提前部署物理机来解决高并发的情况.更方便* 

**安全**

* 物理机: 需要专门的安全人员.
* 云: 免费提供 DDoS 防护、木马查杀、防暴力破解等服务.初期无需专门的安全人员.

**可拓展性**

* 物理机: 所有第三方解决方案需要自己安装搭建.
* 云: 可以随时继承现有第三方解决方案.

**拥抱变化**

相对于创业公司来考量,业务增长的不一定性和变化的速度较快.随着`DI/DC`的日益流行,动态调配需求,易于扩展,低成本,低维护费用.会使我们更容易拥抱变化.

